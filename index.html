<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cristiana & Tibi - Galerie</title>
<style>
  :root{
    --lb-bg: rgba(0,0,0,0.9);
    --tile-gap-m: 4px;
    --tile-gap-d: 10px;
    --lb-radius: 10px;
    --anim-ms: 320ms;
  }
  body {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #ffdde1, #ee9ca7);
    text-align: center;
    padding: 20px;
    color: #5a381e;
  }
  h1 {
    font-family: 'Great Vibes', cursive;
    font-size: 3em;
    margin-bottom: 10px;
  }
  #uploadBtn {
    padding: 12px 30px;
    font-size: 1.2em;
    border-radius: 50px;
    background: #ff4d6d;
    color: white;
    border: none;
    cursor: pointer;
    margin: 20px 0;
  }

  /* --- GALERIE TIP TELEFON (pƒÉtrate egale) --- */
  #preview {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: var(--tile-gap-m);
    max-width: 100%;
  }
  #preview img,
  #preview video {
    width: 100%;
    aspect-ratio: 1 / 1;
    object-fit: cover;
    border-radius: 0;
    box-shadow: none;
    cursor: pointer;
    will-change: transform;
    transition: transform .18s ease-in-out;
  }
  #preview img:hover,
  #preview video:hover { transform: scale(1.03); }
  @media (min-width: 768px) {
    #preview { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: var(--tile-gap-d); }
  }

  /* --- LIGHTBOX --- */
  body.no-scroll { overflow: hidden; }
  #lightbox {
    position: fixed;
    inset: 0;
    background: var(--lb-bg);
    display: none; /* flex c√¢nd e deschis */
    justify-content: center;
    align-items: center;
    z-index: 9999;
  }
  #lightbox[aria-hidden="false"] { display: flex; }
  #lightbox-content {
    max-width: 90vw;
    max-height: 90vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #lightbox img,
  #lightbox video {
    max-width: 100%;
    max-height: 100%;
    border-radius: var(--lb-radius);
    background: #000;
  }
  .lightbox-nav {
    position: absolute; top: 50%; transform: translateY(-50%);
    font-size: 3em; color: #fff; cursor: pointer; padding: 10px; user-select: none;
  }
  .lightbox-prev { left: 20px; }
  .lightbox-next { right: 20px; }
  .lightbox-close { position: absolute; top: 20px; right: 30px; font-size: 2em; color: #fff; cursor: pointer; }
  .lightbox-fs    { position: absolute; top: 20px; left: 30px; font-size: 1.6em; color: #fff; cursor: pointer; user-select: none; }

  /* anima»õii mici */
  .fade-in { animation: fadeIn var(--anim-ms) ease both; }
  .fade-out{ animation: fadeOut var(--anim-ms) ease both; }
  @keyframes fadeIn { from{opacity:0} to{opacity:1} }
  @keyframes fadeOut{ from{opacity:1} to{opacity:0} }

  /* Clona animatƒÉ pentru tranzi»õia tip Instagram */
  .anim-clone{
    position: fixed; inset: auto; z-index: 10000; pointer-events: none; border-radius: var(--lb-radius);
    transform-origin: top left;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
    background: #000;
  }
</style>
</head>
<body>

<h1>üíç Cristiana & Tibi </h1>

<input type="file" id="fileInput" accept="image/*,video/*" multiple style="display:none" />
<button id="uploadBtn">üì∏ √éncarcƒÉ poze sau videoclipuri</button>

<div id="preview"></div>

<!-- LIGHTBOX -->
<div id="lightbox" aria-hidden="true">
  <span class="lightbox-close" title="√énchide">&times;</span>
  <span class="lightbox-fs" title="Ecran complet">‚õ∂</span>
  <span class="lightbox-nav lightbox-prev" title="√énapoi">&#10094;</span>
  <span class="lightbox-nav lightbox-next" title="√énainte">&#10095;</span>
  <div id="lightbox-content"></div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
  // === Config Firebase (client) ===
  const firebaseConfig = {
    apiKey: "AIzaSyAIeoK-hVEcb9ql1eX5ZzXBHCohuSZTAG4",
    authDomain: "cununie-54151.firebaseapp.com",
    projectId: "cununie-54151",
    storageBucket: "cununie-54151.firebasestorage.app",
    messagingSenderId: "847742419904",
    appId: "1:847742419904:web:36b2a2eefe57ed6cc03e25",
    measurementId: "G-808VQG01VC"
  };
  firebase.initializeApp(firebaseConfig);
  const storage = firebase.storage();

  const fileInput = document.getElementById('fileInput');
  const uploadBtn = document.getElementById('uploadBtn');
  const preview   = document.getElementById('preview');

  uploadBtn.onclick = () => fileInput.click();
  fileInput.onchange = async (e) => {
    const files = e.target.files;
    for (let file of files) {
      const storageRef = storage.ref('uploads/' + file.name + '-' + Date.now());
      await storageRef.put(file);
    }
    alert('Fi»ôiere √ÆncƒÉrcate!');
    loadImages();
  };

  // === Lightbox + Fullscreen ===
  const lightbox        = document.getElementById('lightbox');
  const lightboxContent = document.getElementById('lightbox-content');
  const closeBtn = document.querySelector('.lightbox-close');
  const nextBtn  = document.querySelector('.lightbox-next');
  const prevBtn  = document.querySelector('.lightbox-prev');
  const fsBtn    = document.querySelector('.lightbox-fs');

  let galleryItems = []; // elemente DOM (img/video) din grid
  let currentIndex = 0;
  let lastThumbEl  = null; // pentru anima»õia de √Æntoarcere

  function setLightboxVisible(v){
    lightbox.setAttribute('aria-hidden', v? 'false':'true');
    document.body.classList.toggle('no-scroll', v);
  }

  async function openLightbox(index, triggerEl){
    currentIndex = index;
    lastThumbEl = triggerEl || galleryItems[index];

    // 1) pregƒÉtim con»õinutul pentru a mƒÉsura targetRect
    showItem();
    lightbox.style.opacity = 0; // invizibil
    setLightboxVisible(true);
    const targetEl = lightboxContent.firstElementChild;
    const targetRect = targetEl.getBoundingClientRect();
    setLightboxVisible(false);
    lightbox.style.opacity = '';

    // 2) creƒÉm clona la dimensiunea »õintƒÉ, dar pornim din pozi»õia thumb (FLIP)
    const thumbRect = lastThumbEl.getBoundingClientRect();
    const clone = targetEl.cloneNode(true);
    clone.className = 'anim-clone';
    document.body.appendChild(clone);
    Object.assign(clone.style, {
      top: targetRect.top + 'px', left: targetRect.left + 'px', width: targetRect.width + 'px', height: targetRect.height + 'px'
    });
    const dx = thumbRect.left - targetRect.left;
    const dy = thumbRect.top  - targetRect.top;
    const sx = thumbRect.width  / targetRect.width;
    const sy = thumbRect.height / targetRect.height;
    clone.style.transform = `translate(${dx}px, ${dy}px) scale(${sx}, ${sy})`;

    // 3) declan»ôƒÉm anima»õia cƒÉtre pozi»õia finalƒÉ (transform -> none)
    requestAnimationFrame(() => {
      clone.style.transition = `transform var(--anim-ms) cubic-bezier(.2,.8,.2,1), opacity var(--anim-ms)`;
      clone.style.transform = 'none';
      clone.style.opacity = '1';
    });

    // 4) la final: arƒÉtƒÉm lightbox »ôi eliminƒÉm clona
    clone.addEventListener('transitionend', () => {
      clone.remove();
      setLightboxVisible(true);
      lightbox.classList.add('fade-in');
      setTimeout(()=> lightbox.classList.remove('fade-in'), 340);
    }, { once: true });
  }

  function showItem(){
    lightboxContent.innerHTML = '';
    const src = galleryItems[currentIndex].src;
    const isVideo = galleryItems[currentIndex].tagName.toLowerCase() === 'video';
    const el = document.createElement(isVideo ? 'video' : 'img');
    el.src = src;
    if (isVideo) { el.controls = true; el.autoplay = true; el.playsInline = true; }
    el.addEventListener('dblclick', toggleFullscreen);
    lightboxContent.appendChild(el);
  }

  function closeLightbox(){
    // anima»õie inversƒÉ cƒÉtre thumbnail
    const targetEl = lightboxContent.firstElementChild;
    if (targetEl && lastThumbEl) {
      const targetRect = targetEl.getBoundingClientRect();
      const thumbRect  = lastThumbEl.getBoundingClientRect();
      const clone = targetEl.cloneNode(true);
      clone.className = 'anim-clone';
      document.body.appendChild(clone);
      Object.assign(clone.style, {
        top: targetRect.top + 'px', left: targetRect.left + 'px', width: targetRect.width + 'px', height: targetRect.height + 'px', transform: 'none', opacity: '1'
      });
      const dx = thumbRect.left - targetRect.left;
      const dy = thumbRect.top  - targetRect.top;
      const sx = thumbRect.width  / targetRect.width;
      const sy = thumbRect.height / targetRect.height;

      setLightboxVisible(false);
      clone.offsetHeight; // reflow
      clone.style.transition = `transform var(--anim-ms) cubic-bezier(.2,.8,.2,1), opacity var(--anim-ms)`;
      clone.style.transform = `translate(${dx}px, ${dy}px) scale(${sx}, ${sy})`;
      clone.addEventListener('transitionend', () => clone.remove(), { once: true });
    } else {
      setLightboxVisible(false);
    }

    exitFullscreenSafe();
    lightboxContent.innerHTML = '';
  }

  function nextItem(){ currentIndex = (currentIndex + 1) % galleryItems.length; showItem(); }
  function prevItem(){ currentIndex = (currentIndex - 1 + galleryItems.length) % galleryItems.length; showItem(); }

  // === Fullscreen helpers (inclusiv iOS Safari video) ===
  async function requestFullscreenSafe(target){
    try {
      if (!target) target = lightboxContent.firstElementChild || lightbox;
      // iOS Safari: video poate folosi webkitEnterFullscreen (nativ, fƒÉrƒÉ DOM FS)
      if (target.tagName === 'VIDEO' && target.webkitEnterFullscreen && !document.fullscreenEnabled) {
        target.webkitEnterFullscreen();
        return;
      }
      if (target.requestFullscreen) { await target.requestFullscreen(); return; }
      if (target.webkitRequestFullscreen) { await target.webkitRequestFullscreen(); return; }
      if (target.msRequestFullscreen) { await target.msRequestFullscreen(); return; }
      // fallback: cerem pe overlay
      const lb = document.getElementById('lightbox');
      if (lb.requestFullscreen) { await lb.requestFullscreen(); return; }
      if (lb.webkitRequestFullscreen) { await lb.webkitRequestFullscreen(); return; }
    } catch (e) {
      console.warn('Fullscreen error:', e);
    }
  }
  async function exitFullscreenSafe(){
    try {
      if (document.fullscreenElement && document.exitFullscreen) { await document.exitFullscreen(); }
      else if (document.webkitFullscreenElement && document.webkitExitFullscreen) { await document.webkitExitFullscreen(); }
      // iOS video iese singur din nativ; nu avem API dedicat.
    } catch(e){ console.warn('Exit FS error:', e); }
  }
  function isFullscreen(){
    return !!(document.fullscreenElement || document.webkitFullscreenElement);
  }
  function toggleFullscreen(){
    if (isFullscreen()) exitFullscreenSafe(); else requestFullscreenSafe(lightboxContent.firstElementChild);
  }

  // Comenzi lightbox
  lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });
  closeBtn.onclick = closeLightbox;
  nextBtn.onclick  = nextItem;
  prevBtn.onclick  = prevItem;
  fsBtn.onclick    = toggleFullscreen;

  window.addEventListener('keydown', (e) => {
    if (lightbox.getAttribute('aria-hidden') === 'false') {
      if (e.key === 'ArrowRight') nextItem();
      if (e.key === 'ArrowLeft')  prevItem();
      if (e.key === 'Escape')     closeLightbox();
      if (e.key.toLowerCase?.() === 'f') toggleFullscreen();
    }
  });

  // === √éncƒÉrcare imagini din Firebase ===
  async function loadImages() {
    preview.innerHTML = '';
    const listRef = storage.ref('uploads');
    const res = await listRef.listAll();

    // SortƒÉm dupƒÉ nume (con»õine timestamp-ul de la upload)
    const items = res.items.sort((a,b) => a.name.localeCompare(b.name));

    galleryItems = [];
    let index = 0;
    for (const itemRef of items) {
      const url = await itemRef.getDownloadURL();
      let el;
      if (/\.(mp4|webm|ogg)$/i.test(itemRef.name)) {
        el = document.createElement('video');
        el.src = url; el.controls = true; el.playsInline = true;
      } else {
        el = document.createElement('img');
        el.src = url; el.loading = 'lazy';
      }
      el.addEventListener('click', () => openLightbox(index, el));
      galleryItems.push(el);
      preview.appendChild(el);
      index++;
    }
  }

  loadImages();
</script>

</body>
</html>
